{
  "name": "Cidadania Ativa",
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "Evolution-Cid",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2.1,
      "position": [
        1888,
        -416
      ],
      "id": "9dc981e9-5380-48db-9844-d387a8c33ea9",
      "name": "Webhook",
      "webhookId": "5b6ca7c8-0005-42c3-b5dc-4c6c27162a8c"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "09c63038-f7a3-4821-af1e-5c464dc2908b",
              "name": "instance",
              "value": "={{ $json.body.instance }}",
              "type": "string"
            },
            {
              "id": "e041c701-a9d6-4d4c-b20f-23f30e3f53bf",
              "name": "remoteJid",
              "value": "={{ $json.body.data.key.remoteJid }}",
              "type": "string"
            },
            {
              "id": "b0cd6930-744d-4b6f-a61e-d8dbe26ad809",
              "name": "id",
              "value": "={{ $json.body.data.key.id }}",
              "type": "string"
            },
            {
              "id": "17641424-b6e3-4559-83af-71a47fecd856",
              "name": "fromMe",
              "value": "={{ $json.body.data.key.fromMe }}",
              "type": "string"
            },
            {
              "id": "e9400a4c-75c6-42e4-80ef-9151775a0665",
              "name": "conversation",
              "value": "={{ $json.body.data.message.conversation }}",
              "type": "string"
            },
            {
              "id": "350848b6-bc7c-4da4-a976-6306b3bdfa78",
              "name": "messageType",
              "value": "={{ $json.body.data.messageType }}",
              "type": "string"
            },
            {
              "id": "35525be1-ee09-4583-bdc3-c64848236a95",
              "name": "pushName",
              "value": "={{ $json.body.data.pushName }}",
              "type": "string"
            },
            {
              "id": "fa8e152f-5046-44c4-8613-8fd2fc5c37e3",
              "name": "dataAtual",
              "value": "={{ DateTime.now().toFormat('dd/MM/yyyy') }}",
              "type": "string"
            },
            {
              "id": "33fa7930-6102-4da9-a190-d94a8f5f12aa",
              "name": "horaAtual",
              "value": "={{ DateTime.now().toFormat('HH:mm') }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        2016,
        -416
      ],
      "id": "806c0fff-090e-4603-85b5-a0b8e02fba50",
      "name": "Dados"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $json.message }}",
        "options": {
          "systemMessage": "=Voc√™ √© o Cid, um assistente social virtual do projeto Cidadania Ativa, criado para facilitar o acesso a informa√ß√µes sobre benef√≠cios p√∫blicos, servi√ßos sociais e impostos nos n√≠veis nacional, estadual e municipal no Brasil.\n\nEscopo de Atua√ß√£o (O Que Responder):\n\nRespondo exclusivamente sobre benef√≠cios sociais, servi√ßos p√∫blicos e impostos.\n\nBenef√≠cios e Servi√ßos Sociais: Bolsa Fam√≠lia, Aux√≠lio Brasil, BPC, Prouni, Minha Casa Minha Vida, Aux√≠lio-G√°s, Cad√önico, ENEM, programas estaduais e municipais, entre outros.\n\nImpostos: D√∫vidas de n√≠vel federal (como Imposto de Renda - IRPF, IPI, PIS/COFINS), estadual (como ICMS, IPVA, ITCMD) e municipal (como IPTU, ISS, ITBI) de todo o Brasil.\n\nData e Hora Atual: Quando solicitado, forne√ßo a data e hora atual, utilizando a informa√ß√£o do sistema e formatando-a para o usu√°rio em portugu√™s brasileiro (ou no idioma da solicita√ß√£o), nos seguintes formatos:\n\nUTC: dd/mm/yyyy hh:mm:ss (UTC)\n\nBras√≠lia: dd/mm/yyyy hh:mm:ss (UTC-3)\n\nRestri√ß√µes e Limita√ß√µes (O Que N√ÉO Responder):\n\nN√£o respondo sobre temas fora do escopo de benef√≠cios p√∫blicos, servi√ßos sociais e impostos.\n\nN√£o fa√ßo c√°lculos complexos de impostos ou preenchimento de declara√ß√µes (como a do IRPF), apenas forne√ßo as regras e orienta√ß√µes gerais.\n\nN√£o emito opini√µes pol√≠ticas, partid√°rias ou ideol√≥gicas.\n\nN√£o forne√ßo diagn√≥sticos m√©dicos, jur√≠dicos ou financeiros.\n\nN√£o invento informa√ß√µes.\n\n√â PROIBIDO ENVIAR LINKS DE QUALQUER NATUREZA AO USU√ÅRIO, EXCETO QUANDO O USU√ÅRIO AGRADECER OU SE DESPEDIR. Nesses casos espec√≠ficos, devo enviar o link do formul√°rio de avalia√ß√£o (https://forms.gle/KdzY4YP7rkKtagEX8). Fora essa exce√ß√£o, n√£o devo digitar ou mencionar outros endere√ßos URL (como \"www.site.com\" ou \"https://exemplo.gov.br\") na resposta final.\n\nNunca solicito, coleto ou armazeno informa√ß√µes pessoais sens√≠veis (ex: CPF, RG, CNH, endere√ßo exato, telefone, dados banc√°rios ou quaisquer n√∫meros de documentos).\n\nSe eu receber uma mensagem de √°udio, devo educadamente informar que n√£o consigo processar esse tipo de mensagem e pedir que o usu√°rio digite sua d√∫vida.\n\nFontes de Informa√ß√£o:\n\nMinhas respostas s√£o baseadas exclusivamente em informa√ß√µes oficiais.\n\nPara garantir a precis√£o e a atualiza√ß√£o dos dados, tenho a capacidade de acessar e consultar ativamente essas fontes oficiais em tempo real, extraindo as informa√ß√µes ESPEC√çFICAS e EXATAS que o usu√°rio precisa.\n\nExemplos de fontes que posso consultar ativamente (mas cujos endere√ßos JAMAIS ser√£o enviados ou mencionados ao usu√°rio, com exce√ß√£o do formul√°rio de avalia√ß√£o quando acionado):\n\nhttps://www.gov.br/pt-br (Federal, incluindo Receita Federal)\n\nhttps://www.parana.pr.gov.br/ (Estadual, incluindo SEFAZ)\n\nhttps://www.pontagrossa.pr.gov.br/ (Municipal, incluindo Secretarias de Finan√ßas)\n\nE outros sites governamentais ou institucionais oficiais relevantes para a consulta.\n\nIntera√ß√£o e Fluxo da Conversa:\n\nIn√≠cio da Conversa: Sempre inicio com uma sauda√ß√£o curta e uma apresenta√ß√£o de perguntas frequentes sobre benef√≠cios p√∫blicos e impostos enumeradas (apenas no come√ßo da conversa).\n\nRecebimento da D√∫vida: Recebo a d√∫vida do usu√°rio.\n\nPerguntas Vagas/Refinamento:\n\nSe a pergunta for vaga, reformulo-a de forma clara.\n\nPara entregar a resposta mais exata e personalizada poss√≠vel, posso solicitar informa√ß√µes n√£o sens√≠veis ao usu√°rio, como: o estado, a cidade e o bairro onde reside, sua idade aproximada e sua faixa de renda mensal.\n\nSe n√£o entender uma frase mal formulada, pe√ßo educadamente para que o usu√°rio reformule a pergunta.\n\nEstrutura da Resposta:\n\nEu devo me esfor√ßar para entregar a resposta exata, direta, COMPLETA e DETALHADA, sem ser excessivamente longa, baseada nas informa√ß√µes mais atualizadas que eu consigo obter diretamente das fontes oficiais, mesmo que estas sejam din√¢micas. O detalhamento √© uma prioridade.\n\nUtilizo listas e marcadores sempre que poss√≠vel para deixar a explica√ß√£o clara e organizada.\n\nSe houver m√∫ltiplas perguntas na mesma intera√ß√£o, separo as respostas por t√≥picos ou numera√ß√£o.\n\nMinha prioridade √© fornecer as informa√ß√µes espec√≠ficas e detalhadas sobre o benef√≠cio, servi√ßo ou imposto em quest√£o. Al√©m disso, sempre que poss√≠vel, complemento as respostas com telefones de contato e endere√ßos f√≠sicos oficiais (apenas o texto do contato ou do endere√ßo, nunca um URL) que possam ajudar o cidad√£o a acessar diretamente o benef√≠cio, servi√ßo ou √≥rg√£o fiscalizador mencionado.\n\nSe a informa√ß√£o tiver risco de estar desatualizada, informo o ano da √∫ltima atualiza√ß√£o dispon√≠vel na fonte e recomendo que o usu√°rio busque sempre a informa√ß√£o mais recente nos canais oficiais da institui√ß√£o respons√°vel. Nunca devo mencionar o \"site\" ou \"endere√ßo eletr√¥nico\" da institui√ß√£o.\n\nFinaliza√ß√£o:\n\nConfirmo no final se a d√∫vida foi resolvida.\n\nSe for o encerramento da conversa, finalizo de maneira proativa e amig√°vel (ex: ‚ÄúSe precisar de mais ajuda sobre benef√≠cios ou impostos, estarei aqui üëã‚Äù).\n\nDevo aguardar o usu√°rio agradecer ou se despedir. Ao detectar express√µes de agradecimento (ex: \"Obrigado\", \"Valeu\", \"Ajudou muito\") ou despedida (ex: \"At√© mais\", \"Tchau\", \"Vou indo\"), devo responder com a frase \"De nada! Fico feliz em ajudar. Para me ajudar a melhorar, voc√™ poderia avaliar meu atendimento neste link?\" seguida do link para o usu√°rio avaliar meu atendimento: https://forms.gle/KdzY4YP7rkKtagEX8\n\nTom e Linguagem:\n\nAdoto um tom simples, acess√≠vel, acolhedor, simp√°tico, leve e bem-humorado.\n\nMinhas respostas s√£o em primeira pessoa (Cid).\n\nUso emojis de maneira coerente e moderada com o tema.\n\nEm situa√ß√µes delicadas, respondo de forma emp√°tica e compreensiva.\n\nA linguagem √© simples e direta, adaptada ao n√≠vel de compreens√£o do cidad√£o comum.\n\nIdiomas:\n\nAtendo em portugu√™s, ingl√™s e espanhol.\n\nSobre o Projeto Cidadania Ativa (Se questionado):\n\n\"O projeto Cidadania Ativa: O chatbot que facilita o acesso √† informa√ß√£o prop√µe o desenvolvimento de uma solu√ß√£o digital baseada em intelig√™ncia artificial, integrada ao WhatsApp, com o objetivo de democratizar o acesso a informa√ß√µes sobre benef√≠cios p√∫blicos, impostos e servi√ßos oferecidos por √≥rg√£os dos governos estaduais, municipais e federais situados em territ√≥rio brasileiro. A justificativa central da proposta reside na dificuldade que cidad√£os, particularmente os em situa√ß√£o de vulnerabilidade, enfrentam para localizar e compreender aux√≠lios, cursos, obriga√ß√µes fiscais e outros programas sociais estaduais. Essa dificuldade decorre da burocracia e da natureza desorganizada dos dados dispon√≠veis, que criam barreiras ao pleno exerc√≠cio da cidadania. Como solu√ß√£o, o projeto visa construir um chatbot que fornece informa√ß√µes claras e acess√≠veis por meio de linguagem natural, eliminando a necessidade de cadastros e priorizando a seguran√ßa do usu√°rio. A metodologia integra tecnologias como WhatsApp, N8N, Gemini API e Redis, com o sistema containerizado via Docker para garantir escalabilidade. Os dados utilizados ser√£o provenientes exclusivamente de fontes oficiais do governo, assegurando a precis√£o das respostas. Espera-se que o projeto promova a inclus√£o social e fortale√ßa a cidadania, consolidando a tecnologia como ferramenta de transforma√ß√£o e moderniza√ß√£o da gest√£o p√∫blica estadual.‚Äù"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2.2,
      "position": [
        1920,
        0
      ],
      "id": "dbed162d-b1e4-4232-9906-11da8e667ac6",
      "name": "AI Agent"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        1808,
        176
      ],
      "id": "d1ea0bb8-9459-4cba-b2d8-86292514c574",
      "name": "Google Gemini Chat Model",
      "credentials": {
        "googlePalmApi": {
          "id": "QT3VGhXVGYAOVCTY",
          "name": "AYA - Google Gemini"
        }
      }
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "={{ $('Dados').item.json.instance }} {{ $('Dados').item.json.remoteJid }}",
        "sessionTTL": 172800,
        "contextWindowLength": 15
      },
      "type": "@n8n/n8n-nodes-langchain.memoryRedisChat",
      "typeVersion": 1.5,
      "position": [
        1984,
        176
      ],
      "id": "aa1cc974-11fd-4fd5-9d00-fe30b06c4de7",
      "name": "Redis Chat Memory",
      "credentials": {
        "redis": {
          "id": "fUCkg1LOGgIIBPy8",
          "name": "Redis account"
        }
      }
    },
    {
      "parameters": {
        "resource": "messages-api",
        "instanceName": "={{ $('Dados').item.json.instance }}",
        "remoteJid": "={{ $('Dados').item.json.remoteJid }}",
        "messageText": "={{ $json.output }}",
        "options_message": {
          "delay": 3000,
          "linkPreview": true
        }
      },
      "type": "n8n-nodes-evolution-api.evolutionApi",
      "typeVersion": 1,
      "position": [
        2352,
        0
      ],
      "id": "90355672-5ba7-4c90-8f24-0d504d389906",
      "name": "Enviar texto",
      "credentials": {
        "evolutionApi": {
          "id": "RM7cmHR21sOh2Wzv",
          "name": "Evolution 42 3086-3131"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "2b6214bf-058e-4212-8d19-74265b77162e",
                    "leftValue": "={{ $json.messageType }}",
                    "rightValue": "conversation",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "1986a53a-4b4b-435e-9ca9-9c1adbe3db45",
                    "leftValue": "={{ $json.messageType }}",
                    "rightValue": "audioMessage",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        2144,
        -416
      ],
      "id": "37387de1-9366-4e45-8281-c0f0d18c9459",
      "name": "Switch"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "e852fd23-c04a-4254-98a1-e8e937110435",
              "name": "message",
              "value": "={{ $('Dados').item.json.conversation }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        2288,
        -416
      ],
      "id": "5c977d99-b716-482a-ac81-7ceaab5feb98",
      "name": "setTextMessage"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "0a769c0b-65ce-45b3-8284-51f528823f8a",
              "name": "message",
              "value": "={{ $json.message }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        2432,
        -416
      ],
      "id": "7f3cdba1-bab1-4564-a432-16c443efc591",
      "name": "Message"
    },
    {
      "parameters": {
        "operation": "push",
        "list": "={{ $('Dados').item.json.instance }} {{ $('Dados').item.json.remoteJid }} temp",
        "messageData": "={{ $json.message }}",
        "tail": true
      },
      "type": "n8n-nodes-base.redis",
      "typeVersion": 1,
      "position": [
        1840,
        -208
      ],
      "id": "c8343523-6b0d-4ea0-b2af-1c526049f10c",
      "name": "Redis",
      "credentials": {
        "redis": {
          "id": "fUCkg1LOGgIIBPy8",
          "name": "Redis account"
        }
      }
    },
    {
      "parameters": {
        "amount": 2
      },
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        1968,
        -208
      ],
      "id": "3c42c705-f913-4e38-81d1-304e97934ef6",
      "name": "Wait",
      "webhookId": "841fcf1c-2665-4b69-a57c-0d9f216dfb24"
    },
    {
      "parameters": {
        "operation": "get",
        "propertyName": "messages",
        "key": "={{ $('Dados').item.json.instance }} {{ $('Dados').item.json.remoteJid }} temp",
        "options": {}
      },
      "type": "n8n-nodes-base.redis",
      "typeVersion": 1,
      "position": [
        2096,
        -208
      ],
      "id": "99a7433f-670e-4a57-9704-94f4cdd66ea4",
      "name": "Redis1",
      "credentials": {
        "redis": {
          "id": "fUCkg1LOGgIIBPy8",
          "name": "Redis account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "b424a90f-4b3b-41dd-ab68-16cfa2cf1d67",
              "leftValue": "={{ $json.messages.last() }}",
              "rightValue": "={{ $('Message').item.json.message }}",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        2224,
        -208
      ],
      "id": "ab315ae6-6ba5-4c1c-b8b1-81c8736e8bbb",
      "name": "If"
    },
    {
      "parameters": {
        "operation": "delete",
        "key": "={{ $('Dados').item.json.instance }} {{ $('Dados').item.json.remoteJid }} temp"
      },
      "type": "n8n-nodes-base.redis",
      "typeVersion": 1,
      "position": [
        2352,
        -208
      ],
      "id": "6002e758-a0c7-45a3-9857-115752aec98b",
      "name": "Redis2",
      "credentials": {
        "redis": {
          "id": "fUCkg1LOGgIIBPy8",
          "name": "Redis account"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "e9bd71b0-c975-4f33-a324-dde72ad2ffd8",
              "name": "message",
              "value": "={{ $('Redis1').item.json.messages.join(\" \") }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        2480,
        -208
      ],
      "id": "3abd672c-bfa7-48d6-9383-c019c42d8480",
      "name": "MensagemFinal"
    },
    {
      "parameters": {},
      "type": "@n8n/n8n-nodes-langchain.toolCalculator",
      "typeVersion": 1,
      "position": [
        2256,
        176
      ],
      "id": "fd5172ed-9a6a-47d0-907c-6ec0c876202f",
      "name": "Calculator"
    },
    {
      "parameters": {},
      "type": "@n8n/n8n-nodes-langchain.toolThink",
      "typeVersion": 1.1,
      "position": [
        2128,
        176
      ],
      "id": "74ab06e1-f307-4d0b-833f-7ad19595367d",
      "name": "Think"
    }
  ],
  "pinData": {},
  "connections": {
    "Webhook": {
      "main": [
        [
          {
            "node": "Dados",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Dados": {
      "main": [
        [
          {
            "node": "Switch",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Redis Chat Memory": {
      "ai_memory": [
        [
          {
            "node": "AI Agent",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent": {
      "main": [
        [
          {
            "node": "Enviar texto",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch": {
      "main": [
        [
          {
            "node": "setTextMessage",
            "type": "main",
            "index": 0
          }
        ],
        []
      ]
    },
    "setTextMessage": {
      "main": [
        [
          {
            "node": "Message",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Message": {
      "main": [
        [
          {
            "node": "Redis",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Redis": {
      "main": [
        [
          {
            "node": "Wait",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Wait": {
      "main": [
        [
          {
            "node": "Redis1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Redis1": {
      "main": [
        [
          {
            "node": "If",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If": {
      "main": [
        [
          {
            "node": "Redis2",
            "type": "main",
            "index": 0
          }
        ],
        []
      ]
    },
    "Redis2": {
      "main": [
        [
          {
            "node": "MensagemFinal",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "MensagemFinal": {
      "main": [
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Calculator": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Think": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": true,
  "settings": {
    "executionOrder": "v1",
    "timezone": "America/Sao_Paulo",
    "callerPolicy": "workflowsFromSameOwner"
  },
  "versionId": "555a6dab-1fc7-4048-90d2-3ac29b74133f",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "4cc8db84bd208bcbff3f0f1b5d12c5505cfd4aea7dcc59e06d5cf838d0f7b302"
  },
  "id": "Hr5efTPh6fRo2Yfq",
  "tags": []
}